<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>URL Settings</title>
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
    <div class="container">
      <h2 class="page-title">Custom Filaments Configuration</h2>
      <h2>For Versions 0.3.1 and Above</h2>
      <div class="instructions">
        <p id="description">
          To display custom filaments names, please provide here the CSV data of custom filaments as generated by SpoolEase Console Web-Config.
        </p>
        <p>
          In Web-Config under <b>Filaments</b> section, <b>Custom Filaments CSV</b>
          <ul>
            <li>When browsing Web-Config from your slicer desktop, follow instructions there to generate the CSV information</li>
            <li>From mobile, in same place in web-config, press the <b>Copy to Clipboard</b> button, paste copied information here, and press <b>Store</b> </li>
          </ul>
        </p>
      </div>
      <label class="url-label" for="urlInput">Paste Cusotm Filaments CSV Data Here:</label>
      <div>
        <textarea class="file-content" id="csvData"></textarea>
      </div>
      <button class="action-button" id="applyCsvBtn">Store CSV</button>
      <hr/>
      <h2>For SpoolEase Console Versions Until (and Including) 0.3.0</h2>
      <div class="instructions">
        <p id="description">
          To display custom filaments names, please provide here a public URL where the
          custom filaments data can be found. This data should be generated using SpoolEase Desktop.
          This URL will be saved in your browserâ€™s local storage for future use,
          eliminating the need for this step again.
        </p>
        <ul>
          <li>The URL must be publicly accessible</li>
          <li>It must not have CORS restrictions (e.g. Google Drive url won't work, but GitHub will)</li>
          <li>
            The content should be formatted as JSON with your custom filaments information as generated by the Spoolease Desktop App
          </li>
        </ul>
        <p>
          If you want to use GitHub, upload your file to a public GitHub repository or create a public GitHub Gist.
          Then, copy the raw URL of the file (not the web page URL) and store it below. Alternatively, you can use any
          other service that provides a publicly accessible raw file URL, following the same requirements as described above
        </p>
        <p>If the URL field is left empty, it will be removed from local storage.</p>
      </div>

      <div>
        <label class="url-label" for="urlInput">Enter URL:</label>
        <textarea
          class="url-input"
          id="urlInput"
          placeholder="https://my.url.com"
        ></textarea>
      </div>

      <p
        class="confirmation-message"
        id="confirmationMessage"
        style="color: green"
      ></p>
      <button class="action-button" id="applyBtn">Store URL</button>

      <button class="action-button" id="testBtn">Test URL</button>
      <div>
        <textarea class="file-content" id="testResult"></textarea>
      </div>
    </div>

    <script>
      // Function to set the URL to localStorage
      function setUrl() {
        let url = document.getElementById("urlInput").value;
        if (url && url !== "") {
          localStorage.setItem("customFilamentUrl", url);
          document.getElementById("confirmationMessage").textContent =
            "URL Stored Successfully";
        } else {
          localStorage.removeItem("customFilamentUrl");
          document.getElementById("confirmationMessage").textContent =
            "URL Removed From Storate";
        }
      }

      function showUrl() {
        const url = document.getElementById("urlInput").value;
        if (url) {
          document.getElementById("urlInput").value = url;
        }
      }

      // Function to test the URL with a fetch request
      function testUrl() {
        const url = document.getElementById("urlInput").value;
        if (url) {
          fetch(url)
            .then((response) => {
              if (response.ok) {
                return response.text();
              }
              throw new Error("URL fetch failed.");
            })
            .then((data) => {
              document.getElementById("testResult").textContent = data;
            })
            .catch((error) => {
              document.getElementById("testResult").textContent =
                "Error: " + error.message;
            });
        } else {
          alert("Please enter a valid URL to test.");
        }
      }

      function setCsv() {
        let csv = document.getElementById("csvData").value;
        if (csv && csv !== "") {
          localStorage.setItem("customFilamentCsv", csv);
          document.getElementById("confirmationMessage").textContent =
            "CSV Stored Successfully";
        } else {
          localStorage.removeItem("customFilamentCsv");
          document.getElementById("confirmationMessage").textContent =
            "CSV Removed From Storate";
        }
      }

      // Check if there's a URL stored in localStorage and pre-fill the input
      window.onload = () => {
        const storedUrl = localStorage.getItem("customFilamentUrl");
        if (storedUrl) {
          document.getElementById("urlInput").value = storedUrl;
        }
        const storedCsv = localStorage.getItem("customFilamentCsv");
        if (storedCsv) {
          document.getElementById("csvData").value = storedCsv;
        }
      };

      // Event listeners for buttons
      document.getElementById("applyBtn").addEventListener("click", setUrl);
      document.getElementById("testBtn").addEventListener("click", testUrl);
      document.getElementById("applyCsvBtn").addEventListener("click", setCsv);
    </script>
  </body>
</html>
